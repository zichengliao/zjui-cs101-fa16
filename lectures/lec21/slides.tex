%!TEX program = xelatex
\documentclass[11pt]{beamer}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{blindtext}
\usepackage{enumitem}
\usepackage{fancyvrb}
\usepackage{tikz}

\usetheme{SaoPaulo}

\title{Numerical Python}
\subtitle{Error Handling}
\author{CS101 Lecture \#21}
\date{2016-11-09}

\setcounter{showSlideNumbers}{1}

\newcommand{\correctstar}{{\Large\textcolor{red}{$\star$}}}

\begin{document}
  \setcounter{showProgressBar}{0}
  \setcounter{showSlideNumbers}{0}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frame{\titlepage}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setcounter{framenumber}{0}
\setcounter{showProgressBar}{1}
\setcounter{showSlideNumbers}{1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Administrivia}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
  \frametitle{Administrivia}
  \Enlarge

  \begin{itemize}
  \myitem  Homework \#10 is due Friday, Nov.\ 11.
  \myitem  Homework \#11 is due Friday, Nov.\ 18.  \textcolor{CS101PureBase}{Will be posted soon.}
  \myitem  Midterm \#2 is Monday, Nov. 14 from 7--8 p.m.  Sections and rooms are posted on the website---same as last time.

  \end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Warmup Quiz}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#1}
  \Enlarge

Which of the following optimization techniques repeatedly moves to the best neighboring solution?

  \begin{enumerate}[label=\Alph*]
    \item  Hill climbing
    \item  Brute force
    \item  Random sampling
    \item  Random walk
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#1}
  \Enlarge

Which of the following optimization techniques repeatedly moves to the best neighboring solution?

  \begin{enumerate}[label=\Alph*]
    \item  Hill climbing  \correctstar
    \item  Brute force
    \item  Random sampling
    \item  Random walk
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#2}
  \Enlarge

  \begin{Verbatim}
z = 13
n = np.array( (1,0) )
s = np.array( (-1,0) )
e = np.array( (0,1) )
w = np.array( (0,-1) )
d = [ n,s,e,w ]
x = np.array( (z//2,z//2) )
x += d[ np.random.randint( 0,4 ) ]
  \end{Verbatim}

  What does \texttt{x} represent in this code?

  \begin{enumerate}[label=\Alph*]
    \item  direction of travel
    \item  current location in array
    \item  step in a random direction
    \item  array of possible locations incl. current
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#2}
  \Enlarge

  \begin{Verbatim}
z = 13
n = np.array( (1,0) )
s = np.array( (-1,0) )
e = np.array( (0,1) )
w = np.array( (0,-1) )
d = [ n,s,e,w ]
x = np.array( (z//2,z//2) )
x += d[ np.random.randint( 0,4 ) ]
  \end{Verbatim}

  What does \texttt{x} represent in this code?

  \begin{enumerate}[label=\Alph*]
    \item  direction of travel
    \item  current location in array  \correctstar
    \item  step in a random direction
    \item  array of possible locations incl. current
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#2}
  \Enlarge

  \begin{Verbatim}
d = np.zeros( ( 3,4 ) )

if ???:
    print( 'a zero was found in the array' )
  \end{Verbatim}

  Which of the following comparisons should be included to make this code check if the array contains at least one zero?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{d has 0}
    \item  \texttt{0 in d}
    \item  \texttt{d.any() == 0}
    \item  \texttt{d.all() == 0}
    \item  \texttt{d == 0}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Question \#2}
  \Enlarge

  \begin{Verbatim}
d = np.zeros( ( 3,4 ) )

if ???:
    print( 'a zero was found in the array' )
  \end{Verbatim}

  Which of the following comparisons should be included to make this code check if the array contains at least one zero?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{d has 0}
    \item  \texttt{0 in d}  \correctstar
    \item  \texttt{d.any() == 0}  \correctstar
    \item  \texttt{d.all() == 0}
    \item  \texttt{d == 0}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Error Handling}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Common exceptions}
  \Enlarge

  \begin{enumerate}
  \myitem  \texttt{SyntaxError}
  \myitem  \texttt{NameError}
  \myitem  \texttt{TypeError}
  \myitem  \texttt{ValueError}
  \myitem  \texttt{IOError}
  \myitem  \texttt{IndexError}
  \myitem  \texttt{KeyError}
  \myitem  \texttt{ZeroDivisionError}
  \myitem  \texttt{IndentationError}
  \myitem  \texttt{Exception}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Exception handling}
  \Enlarge

  \begin{enumerate}
  \myitem  Most of the time, we want errors to happen---but we may not want our program to crash (stop executing)! \pause
  \myitem  We can tell Python to \texttt{try} a block of code, and it will run normally \texttt{except} if something goes wrong. \pause
  \end{enumerate}
  \begin{Verbatim}
d = list( range( 10 ) )
i = 0
while i < len( d )+1:
    try:
        d[ i ] = d[ i ] ** 2.0
        i += 1
    except:
        print( 'An error occurred.' )
        break
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Exception handling}
  \Enlarge

  \begin{enumerate}
  \myitem  The advantage:  you can handle the error and execution can proceed normally.
  \myitem  The disadvantage:  the traceback doesn't appear automatically. \pause
  \myitem  This also doesn't guard against errors or bugs which don't raise an exception:
  \end{enumerate}
  \begin{Verbatim}
d = list( range( 10 ) )
i = 0
while i < len( d )+1:
    try:
        d[ i ] = d[ i ] ** 2.0
        i += 1
    except:
        print( 'An error occurred.' )
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
try:
    x = 1 / 0
except ZeroDivisionError:
    print("Division by zero occurred.")
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
denom = 0
while True:
    try:
        # Read int from console.
        denom = input()

        # Use as denominator.
        i = 1 / float(denom)
    except:
        print("non-numeric value entered")
    else:
        print(i)
    finally:
        if denom == 'q': break
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
try:
    # the main code
except:
    # an error occurs
else:
    # but if no error occurs
finally:
    # in either case, this happens
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{enumerate}
  \myitem  If we lose the information on what went wrong, our response may not be appropriate. \pause
  \myitem  What could have gone wrong in the code below?
  \end{enumerate}

  \begin{Verbatim}
filename = 'spring.data'
try:
    data = open( filename,'r' )
except:
    print( 'Unable to open file "%s".'%filename )
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{enumerate}
  \myitem  It is often preferable to handle different kinds of errors separately:
  \end{enumerate}

  \begin{Verbatim}
filename = 'spring.data'
try:
    data = open( filename,'r' )
except IOError as err:
    print( 'Unable to open file "%s" with error "%s".'%(filename,err) )
finally:
    print( 'Done with file I/O code.' )
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{enumerate}
  \myitem  Finally, use \texttt{try} at the finest degree of precision you can:
  \end{enumerate}

  \begin{Verbatim}
filename = 'spring.data'
try:
    data = open( filename,'r' )
except IOError as err:
    ...
  \end{Verbatim}

  is better than

  \begin{Verbatim}
filename = 'spring.data'
try:
    data = open( filename,'r' )
    for line in data:
        ...
except IOError as err:
    ...
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
a = [ 'a','n','y' ]
try:
    a[ 3 ] = '.'
except IndexError:
    pass  # does nothing
a[0][0] = 'b'
  \end{Verbatim}

  Which uncaught error will cause this code to terminate?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{IndexError}
    \item  \texttt{TypeError}
    \item  \texttt{OSError}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
a = [ 'a','n','y' ]
try:
    a[ 3 ] = '.'
except IndexError:
    pass  # does nothing
a[0][0] = 'b'
  \end{Verbatim}

  Which uncaught error will cause this code to terminate?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{IndexError}
    \item  \texttt{TypeError}  \correctstar
    \item  \texttt{OSError}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
???
try:
    a[ 4 ] *= 2
except TypeError:
    pass
finally:
    print( 'No error arose.' )
  \end{Verbatim}

  Which line replacing the \texttt{???} will raise an uncaught error?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{a = '12345'}
    \item  \texttt{a = [ 1,2,3,4 ]}
    \item  \texttt{a = ( 1,2,3,4,5 )}
    \item  \texttt{a = np.ones( ( 10, ) )}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Examples}
  \Enlarge

  \begin{Verbatim}
???
try:
    a[ 4 ] *= 2
except TypeError:
    pass
finally:
    print( 'No error arose.' )
  \end{Verbatim}

  Which line replacing the \texttt{???} will raise an uncaught error?

  \begin{enumerate}[label=\Alph*]
    \item  \texttt{a = '12345'}
    \item  \texttt{a = [ 1,2,3,4 ]}  \correctstar
    \item  \texttt{a = ( 1,2,3,4,5 )}
    \item  \texttt{a = np.ones( ( 10, ) )}
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Configuration Files}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Configuration}
  \Enlarge

  \begin{enumerate}
  \myitem  We don't like magic numbers, and we prefer not to hard-code values that can change.
  \myitem  It's also inconvenient to ask the user for input every time. \pause
  \myitem  A \emph{configuration file} allows us to store parameters (like grid size or spacing) where they can easily be changed if necessary.
  \end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Configuration}
  \Enlarge

  {\textbf\texttt{config.ini}}:
  \begin{Verbatim}
dx,1e-3
dy,1e-3
n,1200
  \end{Verbatim}
  \bigskip
  \begin{Verbatim}
config_file = open( './config.ini','r' )
for line in config_file:
    param = '='.join(line.split(','))
    exec( param )
config_file.close()
  \end{Verbatim}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]
  \frametitle{Configuration}
  \Enlarge

  \begin{enumerate}
  \myitem  \texttt{exec} accepts Python code as a string and evaluates it. \pause
  \myitem  This is rather dangerous, so use it carefully!
  \end{enumerate}
\end{frame}

\end{document}
